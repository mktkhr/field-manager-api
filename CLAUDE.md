# CLAUDE.md

Go + Gin + oapi-codegen ã‚’ä½¿ç”¨ã—ãŸ Package by Feature + ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆã®APIã‚µãƒ¼ãƒãƒ¼ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
project-root/
â”œâ”€â”€ api/                    # OpenAPIä»•æ§˜æ›¸ã€ç”Ÿæˆè¨­å®š
â”œâ”€â”€ bin/                    # ãƒ“ãƒ«ãƒ‰æˆæœç‰©
â”œâ”€â”€ cmd/server/             # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ(main.go)
â”œâ”€â”€ config/                 # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ç§˜å¯†éµ
â”œâ”€â”€ db/queries/             # SQLCã‚¯ã‚¨ãƒªãƒ•ã‚¡ã‚¤ãƒ«(.sql)
â”œâ”€â”€ docker/                 # Dockerè¨­å®š
â”œâ”€â”€ docs/                   # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ internal/               # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ¬ä½“
â””â”€â”€ scripts/                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

## internal/ æ§‹æˆ

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª         | å½¹å‰²                                                 |
| -------------------- | ---------------------------------------------------- |
| `features/`          | æ©Ÿèƒ½åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸(auth, token, session, user, client) |
| `generated/openapi/` | oapi-codegenç”Ÿæˆã‚³ãƒ¼ãƒ‰(ç·¨é›†ç¦æ­¢)                     |
| `generated/sqlc/`    | SQLCç”Ÿæˆã‚³ãƒ¼ãƒ‰(ç·¨é›†ç¦æ­¢)                             |
| `server/`            | Ginãƒ«ãƒ¼ã‚¿ãƒ¼ã€DIã€ã‚µãƒ¼ãƒãƒ¼èµ·å‹•                        |
| `middleware/`        | èªè¨¼ã€CORSã€ãƒ­ã‚°ç­‰ã®ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢                     |
| `infrastructure/`    | DBæ¥ç¶š(postgres, redis, valkey)ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³    |
| `config/`            | è¨­å®šæ§‹é€ ä½“ã€ãƒ­ãƒ¼ãƒ€ãƒ¼                                 |
| `apperror/`          | ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼å‹                                     |
| `logger/`            | slogãƒ™ãƒ¼ã‚¹ã®ãƒ­ã‚®ãƒ³ã‚°                                 |
| `utils/`             | å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£                                   |

## Feature ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ(ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)

```
internal/features/<feature>/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entity/         # ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€Value Object
â”‚   â””â”€â”€ repository/     # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ usecase/        # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å®Ÿè£…
â”‚   â”œâ”€â”€ port/           # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â””â”€â”€ query/          # CQRSèª­ã¿å–ã‚Šç³»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ repository/     # ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…(DBæ›¸ãè¾¼ã¿)
â”‚   â”œâ”€â”€ query/          # ã‚¯ã‚¨ãƒªå®Ÿè£…(DBèª­ã¿å–ã‚Š)
â”‚   â””â”€â”€ external/       # å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
â””â”€â”€ presentation/
    â””â”€â”€ handler.go      # HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼(ServerInterfaceå®Ÿè£…)
```

## ä¾å­˜é–¢ä¿‚ãƒ«ãƒ¼ãƒ«

```
Presentation â†’ Application â†’ Domain â† Infrastructure
```

- å†…å´ã®å±¤ã¯å¤–å´ã«ä¾å­˜ã—ãªã„
- Domainå±¤ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ã€Infrastructureå±¤ã§å®Ÿè£…

## ä¸»è¦ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰             | èª¬æ˜                         |
| -------------------- | ---------------------------- |
| `make build`         | ãƒ“ãƒ«ãƒ‰                       |
| `make run`           | ãƒ“ãƒ«ãƒ‰&å®Ÿè¡Œ                  |
| `make test`          | å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ                 |
| `make lint`          | Lintå®Ÿè¡Œ                     |
| `make api-generate`  | OpenAPIã‹ã‚‰ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ        |
| `make sqlc-generate` | SQLCã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ             |
| `make generate`      | å…¨ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ                 |
| `make dev`           | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼(ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰) |

## Gitã‚³ãƒŸãƒƒãƒˆ

**ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: `{type}:{emoji}{å¯¾è±¡ã®èª¬æ˜}(#ãƒã‚±ãƒƒãƒˆç•ªå·)`
**Type**: add(æ–°æ©Ÿèƒ½) / fix(ãƒã‚°) / update(æ”¹å–„) / refactor / docs / test / style / chore / remove
**Emoji**: ğŸ“(ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ) / ğŸ›(ãƒã‚°) / âš¡(æ”¹å–„) / â™»ï¸(ãƒªãƒ•ã‚¡ã‚¯ã‚¿) / ğŸ“š(ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ) / ğŸ§ª(ãƒ†ã‚¹ãƒˆ) / ğŸ¨(UI) / ğŸ”§(è¨­å®š) / ğŸ—‘ï¸(å‰Šé™¤) / âœ¨(æ–°æ©Ÿèƒ½) / ğŸ”’(ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)

**é‡è¦ãƒ«ãƒ¼ãƒ«**:
- "Generated with Claude Code" / "Co-Authored-By: Claude" å«ã‚ãªã„
- å¤‰æ›´å†…å®¹ã®ã¿è¨˜è¿°(ç†ç”±ãƒ»å½±éŸ¿æ˜è¨˜)
- ãƒã‚±ãƒƒãƒˆç•ªå·=ãƒ–ãƒ©ãƒ³ãƒå`feature/xxxxx`ã®`xxxxx`éƒ¨åˆ†

**ç²’åº¦**: 1æ©Ÿèƒ½=1ã‚³ãƒŸãƒƒãƒˆ / ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥åˆ¥ / å½±éŸ¿ç¯„å›²åˆ¥ / WIPç¦æ­¢

## ç¦æ­¢äº‹é …
- å…¨è§’ï¼ˆï¼‰ã®ä½¿ç”¨
- Testã‚’ãƒ‘ã‚¹ã•ã›ã‚‹ãŸã‚ã«ã€Skipã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
- Testä»¥å¤–ã§ã®errorã® `_` ã‚’ä½¿ã£ãŸãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å›é¿
- æ©Ÿèƒ½(Feature)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã®ç›´æ¥çš„ãª `import` ã§ã®å‚ç…§
  - ã‚ã‚‹æ©Ÿèƒ½(Consumer)ãŒåˆ¥ã®æ©Ÿèƒ½(Provider)ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¿…è¦ã¨ã™ã‚‹å ´åˆã€**Consumerå´ã§å¿…è¦ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©** ã—ã€Providerã®å®Ÿè£…ã«ä¾å­˜ã—ãªã„ã‚ˆã†ã«ã—ã¦å¯¾å¿œã—ã¦ãã ã•ã„

## é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ–°æ©Ÿèƒ½è¿½åŠ ï¼‰

**æ‰‹é †**:
1. **APIä»•æ§˜**: `api/openapi.yaml`å®šç¾© â†’ `make api-validate` â†’ `make api-generate`
2. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ**: `mkdir -p features/<name>/{application/{query,usecase},domain/{entity,repository},infrastructure/{query,repository},presentation}`
3. **å®Ÿè£…**: Domain(Entity+RepoIF) â†’ Application(QueryIF+Usecase) â†’ Infrastructure(Query/Repoå®Ÿè£…) â†’ Presentation(ServerIF)
4. **ãƒ†ã‚¹ãƒˆ**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§`*_test.go`ï¼ˆå˜ä½“ï¼‰/`*_integration_test.go`(çµ±åˆ)ä½œæˆ
5. **DIç™»éŒ²**: `internal/server/router.go`ã«è¿½åŠ 
6. **æ¤œè¨¼**: `make test` â†’ `make cover` â†’ `make lint` â†’ `make gesec-scan` â†’ `make build`
